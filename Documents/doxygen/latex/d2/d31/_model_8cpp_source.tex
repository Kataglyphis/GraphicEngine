\hypertarget{_model_8cpp_source}{}\doxysection{Model.\+cpp}
\label{_model_8cpp_source}\index{C:/Users/jonas/Desktop/GraphicEngine/Src/scene/Model.cpp@{C:/Users/jonas/Desktop/GraphicEngine/Src/scene/Model.cpp}}
\mbox{\hyperlink{_model_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00001}00001 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{_model_8h}{Model.h}}"{}}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00003}\mbox{\hyperlink{class_model_ae3b375de5f6df4faf74a95d64748e048}{00003}} \mbox{\hyperlink{class_model_ae3b375de5f6df4faf74a95d64748e048}{Model::Model}}() : aabb(\mbox{\hyperlink{namespacestd}{std}}::make\_shared<\mbox{\hyperlink{class_a_a_b_b}{AABB}}>()) \{ \}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00004}00004 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00005}\mbox{\hyperlink{class_model_ad08db76f4672ceeb57766be6b92a1223}{00005}} std::shared\_ptr<AABB> \mbox{\hyperlink{class_model_ad08db76f4672ceeb57766be6b92a1223}{Model::get\_aabb}}() \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_model_a033e87c24e4e58c8bdfadb4a02dbf2a9}{aabb}}; \}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00006}00006 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00007}\mbox{\hyperlink{class_model_a3d4cf0e1dce8bfc4aedcfbd11e3abb97}{00007}} std::vector<ObjMaterial> \mbox{\hyperlink{class_model_a3d4cf0e1dce8bfc4aedcfbd11e3abb97}{Model::get\_materials}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{class_model_a7cba4923a9806fc94cdb1d245e701113}{materials}}; \}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00008}00008 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00009}\mbox{\hyperlink{class_model_aea91d7b0d0ecc40bf21359bf6b5146cd}{00009}} \textcolor{keywordtype}{int} \mbox{\hyperlink{class_model_aea91d7b0d0ecc40bf21359bf6b5146cd}{Model::get\_texture\_count}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \textcolor{keyword}{static\_cast<}uint32\_t\textcolor{keyword}{>}(\mbox{\hyperlink{class_model_a94b3624baee6038c0c568d63671ef718}{texture\_list}}.size()); \}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00010}00010 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00011}\mbox{\hyperlink{class_model_a73635a4127d2843e7ee392a78beed3ac}{00011}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_model_a73635a4127d2843e7ee392a78beed3ac}{Model::load\_model\_in\_ram}}(\textcolor{keyword}{const} std::string\& model\_path)}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00012}00012 \{}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00013}00013 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00014}00014   \mbox{\hyperlink{class_model_acca54d89c856dfdd0be645912d8786dd}{loader}} = \mbox{\hyperlink{class_obj_loader}{ObjLoader}}();}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00015}00015   \mbox{\hyperlink{class_model_acca54d89c856dfdd0be645912d8786dd}{loader}}.\mbox{\hyperlink{class_obj_loader_a41db1c0ada11d10ae9a60c5aa78b0920}{load}}(model\_path, \mbox{\hyperlink{class_model_ae69c72e4776b916f3ffd2e18a70ba605}{vertices}}, \mbox{\hyperlink{class_model_a52bf7d84e4bd938767f41565f898d5dc}{indices}}, \mbox{\hyperlink{class_model_a82c4b4618a960db5eed5602a7c138ab8}{textures}}, \mbox{\hyperlink{class_model_a7cba4923a9806fc94cdb1d245e701113}{materials}}, \mbox{\hyperlink{class_model_ac25a39c318a2295730dff9115f5d6797}{materialIndex}});}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00016}00016 \}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00018}00018 \textcolor{comment}{// all OpenGL calls need to be on the same thread!}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00019}00019 \textcolor{comment}{// hence we have to decouple the loading task from all OpenGL agnostic code}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00020}\mbox{\hyperlink{class_model_aa3be236470952c01bb9f3dccc68650b3}{00020}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_model_aa3be236470952c01bb9f3dccc68650b3}{Model::create\_render\_context}}()}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00021}00021 \{}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00022}00022   \mbox{\hyperlink{class_model_a94b3624baee6038c0c568d63671ef718}{texture\_list}}.resize(\mbox{\hyperlink{class_model_a82c4b4618a960db5eed5602a7c138ab8}{textures}}.size());}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00023}00023 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00024}00024   \textcolor{keywordflow}{for} (uint32\_t i = 0; i < static\_cast<uint32\_t>(\mbox{\hyperlink{class_model_a82c4b4618a960db5eed5602a7c138ab8}{textures}}.size()); i++) \{}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00025}00025 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00026}00026     \mbox{\hyperlink{class_model_a94b3624baee6038c0c568d63671ef718}{texture\_list}}[i] = std::make\_shared<Texture>(\mbox{\hyperlink{class_model_a82c4b4618a960db5eed5602a7c138ab8}{textures}}[i].c\_str(), std::make\_shared<RepeatMode>());}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00028}00028     \textcolor{keywordflow}{if} (!\mbox{\hyperlink{class_model_a94b3624baee6038c0c568d63671ef718}{texture\_list}}[i]-\/>load\_SRGB\_texture\_without\_alpha\_channel()) \{}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00029}00029       printf(\textcolor{stringliteral}{"{}Failed to load texture at: \%s\(\backslash\)n"{}}, \mbox{\hyperlink{class_model_a82c4b4618a960db5eed5602a7c138ab8}{textures}}[i].c\_str());}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00030}00030       \mbox{\hyperlink{class_model_a94b3624baee6038c0c568d63671ef718}{texture\_list}}[i].reset();}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00031}00031     \}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00032}00032   \}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00034}00034   \mbox{\hyperlink{class_model_ae28a557329ebec3aaf91f8012f6c0c02}{mesh}} = std::make\_shared<Mesh>(\mbox{\hyperlink{class_model_ae69c72e4776b916f3ffd2e18a70ba605}{vertices}}, \mbox{\hyperlink{class_model_a52bf7d84e4bd938767f41565f898d5dc}{indices}});}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00035}00035 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00036}00036   \textcolor{comment}{// https://www.khronos.org/opengl/wiki/Shader\_Storage\_Buffer\_Object}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00037}00037   glGenBuffers(1, \&\mbox{\hyperlink{class_model_ab8b3bec22f784608ab53bc4cd298d2e8}{ssbo}});}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00038}00038   glBindBuffer(GL\_SHADER\_STORAGE\_BUFFER, \mbox{\hyperlink{class_model_ab8b3bec22f784608ab53bc4cd298d2e8}{ssbo}});}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00039}00039   glBufferData(GL\_SHADER\_STORAGE\_BUFFER,}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00040}00040     \mbox{\hyperlink{class_model_ac25a39c318a2295730dff9115f5d6797}{materialIndex}}.size() * \textcolor{keyword}{sizeof}(glm::vec4),}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00041}00041     \mbox{\hyperlink{class_model_ac25a39c318a2295730dff9115f5d6797}{materialIndex}}.data(),}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00042}00042     GL\_STREAM\_READ); \textcolor{comment}{//sizeof(data) only works for statically sized C/C++ arrays.}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00043}00043 \}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00044}00044 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00045}\mbox{\hyperlink{class_model_abea22e8123549c261cc80a366a2ed93b}{00045}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_model_abea22e8123549c261cc80a366a2ed93b}{Model::bind\_ressources}}()}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00046}00046 \{}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00047}00047   glBindBufferBase(GL\_SHADER\_STORAGE\_BUFFER, \mbox{\hyperlink{bindings_8h_a934aa1a1a657e97b7ce0af0aaf957d9d}{STORAGE\_BUFFER\_MATERIAL\_ID\_BINDING}}, \mbox{\hyperlink{class_model_ab8b3bec22f784608ab53bc4cd298d2e8}{ssbo}});}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00048}00048   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < static\_cast<int>(\mbox{\hyperlink{class_model_a94b3624baee6038c0c568d63671ef718}{texture\_list}}.size()); i++) \{}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00049}00049     \mbox{\hyperlink{class_model_a94b3624baee6038c0c568d63671ef718}{texture\_list}}[i]-\/>use\_texture(i + \mbox{\hyperlink{bindings_8h_a9b0d1cd1d0e10441196f4451e91713c8}{MODEL\_TEXTURES\_SLOT}});}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00050}00050   \}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00051}00051 \}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00052}00052 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00053}\mbox{\hyperlink{class_model_acf8689f9ce360896172eafb2ab896039}{00053}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_model_acf8689f9ce360896172eafb2ab896039}{Model::unbind\_resources}}()}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00054}00054 \{}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00055}00055   glBindBuffer(GL\_SHADER\_STORAGE\_BUFFER, 0);}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00056}00056   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < static\_cast<int>(\mbox{\hyperlink{class_model_a94b3624baee6038c0c568d63671ef718}{texture\_list}}.size()); i++) \{}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00057}00057     \mbox{\hyperlink{class_model_a94b3624baee6038c0c568d63671ef718}{texture\_list}}[i]-\/>unbind\_texture(i + \mbox{\hyperlink{bindings_8h_a9b0d1cd1d0e10441196f4451e91713c8}{MODEL\_TEXTURES\_SLOT}});}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00058}00058   \}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00059}00059 \}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00060}00060 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00061}\mbox{\hyperlink{class_model_a89ebd61864089abe5b0c5a1df6479970}{00061}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_model_a89ebd61864089abe5b0c5a1df6479970}{Model::render}}() \{ \mbox{\hyperlink{class_model_ae28a557329ebec3aaf91f8012f6c0c02}{mesh}}-\/>render(); \}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00062}00062 }
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00063}\mbox{\hyperlink{class_model_ad6ebd2062a0b823db841a0b88baac4c0}{00063}} \mbox{\hyperlink{class_model_ad6ebd2062a0b823db841a0b88baac4c0}{Model::\string~Model}}()}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00064}00064 \{}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00065}00065   \textcolor{comment}{// unbind material index buffer}}
\DoxyCodeLine{\Hypertarget{_model_8cpp_source_l00066}00066 \}}

\end{DoxyCode}
